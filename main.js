(()=>{"use strict";var e="https://nomoreparties.co/v1/plus-cohort-9",t="fee29014-062b-4401-8525-ee1398a9c8ac",o=document.querySelector(".profile__edit-button"),n=document.querySelector(".popup-edit"),r=document.querySelector(".popup-card"),c=document.querySelector(".profile__add-button"),a=document.querySelector(".form__text_input_name"),i=document.querySelector(".form__text_input_job"),u=document.querySelector(".profile__name"),s=document.querySelector(".profile__text"),l=document.querySelector(".popup_form-profile"),d=document.querySelector(".profile__avatar-container"),p=document.querySelector(".popup-profile"),_=document.querySelector(".popup__avatar"),m=document.querySelector(".profile__avatar"),f=document.querySelector(".form__text_input_link-profile"),v=document.querySelector(".popup__avatar-submit"),h=document.querySelector(".form__submit-profile");function y(e){e.classList.add("popup_opened"),document.addEventListener("keydown",q)}function S(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",q)}function q(e){"Escape"===e.key&&S(document.querySelector(".popup_opened"))}var x=document.querySelector(".popup-card"),C=document.querySelector(".card"),b=document.querySelector(".popup-photo"),L=document.querySelector(".popup-photo__name"),g=document.querySelector(".popup-photo__img"),E=document.querySelector(".popup__form-card"),k=document.querySelector(".popup-card__button"),T="9d9242d0ffb0293e65591c4a",j=document.querySelector(".card-template").content,A=document.querySelector(".form__text_input_name-card"),z=document.querySelector(".form__text_input_link-card");function P(e){var o=function(e){var o=j.cloneNode(!0);o.querySelector(".card__name").innerText=e.name;var n=o.querySelector(".card__number-like");n.innerText=e.likes.length;var r=o.querySelector(".card__image"),c=o.querySelector(".card__delete"),a=o.querySelector(".card__like");return e.likes.forEach((function(e){e._id===T&&a.classList.add("card__like_active")})),a.innerText=e._id,c.innerText=e._id,e.link?r.src=e.link:r.src="https://imagetext2.ru/pics_max/images_3162.gif",e.owner._id!=T&&c.classList.add("card__delete_disable"),r.alt=e.name,a.addEventListener("click",(function(o){var r;"card__like_active"!=o.target.classList[1]?(r="https://nomoreparties.co/v1/plus-cohort-9/cards/likes/"+o.target.innerText,fetch(r,{method:"PUT",headers:{authorization:t,"Content-Type":"application/json"}}),n.innerText=e.likes.length+1):(function(e){fetch(e,{method:"DELETE",headers:{authorization:t,"Content-Type":"application/json"}})}("https://nomoreparties.co/v1/plus-cohort-9/cards/likes/"+o.target.innerText),n.innerText=e.likes.length-1),o.target.classList.toggle("card__like_active")})),r.addEventListener("click",(function(e){y(b);var t=e.target;L.innerText=t.getAttribute("alt"),g.src=t.getAttribute("src"),g.alt=t.getAttribute("alt")})),o.querySelector(".card__delete").addEventListener("click",D),o}(e);C.prepend(o)}function D(e){var o;e.target.closest(".card__item").remove(),o="https://nomoreparties.co/v1/plus-cohort-9/cards/"+e.target.innerText,fetch(o,{method:"DELETE",headers:{authorization:t,"Content-Type":"application/json"}})}var B,w=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o.inactiveButtonClass),t.disabled=!1):(t.classList.add(o.inactiveButtonClass),t.disabled=!0)};document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&S(e),t.target.classList.contains("popup__close")&&S(e)}))})),o.addEventListener("click",(function(){y(n),a.value=u.textContent,i.value=s.textContent})),d.addEventListener("click",(function(){y(p)})),c.addEventListener("click",(function(){y(r)})),_.addEventListener("submit",(function(o){var n;o.preventDefault(),v.textContent="Сохранить...",m.src=f.value,n=f.value,fetch(e+"/users/me/avatar",{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}),S(p),v.textContent="Сохранить",f.value="",v.classList.add("form__button_inactive"),v.disabled=!0})),l.addEventListener("submit",(function(o){var r,c;o.preventDefault(),h.textContent="Сохранить...",u.textContent=a.value,s.textContent=i.value,r=u.textContent,c=s.textContent,fetch(e+"/users/me",{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:r,about:c})}),S(n),h.textContent="Сохранить"})),E.addEventListener("submit",(function(o){o.preventDefault(),k.textContent="Создать...",function(o,n){fetch(e+"/cards",{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:n})})}(A.value,z.value),S(x),k.textContent="Создать",A.value="",z.value="",k.classList.add("form__button_inactive"),k.disabled=!0})),B={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(B.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);w(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,r,t),w(o,n,t)}))}))}(e,B)})),fetch(e+"/users/me",{headers:{authorization:t}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){u.textContent=e.name,s.textContent=e.about})).catch((function(e){console.log(e)})),fetch(e+"/cards",{headers:{authorization:t}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach(P)})).catch((function(e){console.log(e)}));var N=document.querySelector(".profile__avatar");fetch(e+"/users/me",{headers:{authorization:t}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){N.src=e.avatar})).catch((function(e){console.log(e)}))})();